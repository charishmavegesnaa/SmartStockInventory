<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStock - Register</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 50%;
            background: linear-gradient(135deg, #e0e7ff 0%, #f0e6ff 50%, #ffe6f0 100%);
            z-index: -1;
        }

        body::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 50%;
            background: radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(240, 147, 251, 0.06) 0%, transparent 50%);
            z-index: -1;
        }

        .register-container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
            position: relative;
        }

        .register-container::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 10%;
            bottom: 10%;
            width: 2px;
            background: linear-gradient(180deg, transparent, #2d3748, transparent);
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(45, 55, 72, 0.1);
        }

        .register-info {
            color: #000000;
            padding: 40px 0;
        }

        .register-info h2 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
            color: #000000;
        }

        .register-info p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #333333;
        }

        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-left: 3px solid #667eea;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .feature-item:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 12px;
            display: block;
        }

        .feature-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #667eea;
        }

        .feature-content p {
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
            opacity: 0.8;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .register-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            border: 2px solid #000000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 
                        0 0 0 1px rgba(0, 0, 0, 0.05),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            padding: 50px 45px;
            animation: slideUp 0.4s ease-out;
            position: relative;
        }

        .register-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.02) 0%, transparent 50%);
            border-radius: 12px;
            pointer-events: none;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            margin: 0 auto 20px;
            color: white;
            font-size: 28px;
            font-weight: bold;
        }

        h1 {
            font-size: 28px;
            color: #1a202c;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 14px;
            color: #718096;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"] {
            width: 100%;
            padding: 12px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            color: #2d3748;
            background: #f7fafc;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="email"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Role Tabs Styles */
        .role-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            background: #f7fafc;
            padding: 6px;
            border-radius: 12px;
            border: 1.5px solid #e2e8f0;
        }

        .role-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .role-tab:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 8px;
        }

        .role-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .role-tab.active:before {
            opacity: 1;
        }

        .role-tab.active .role-tab-text {
            position: relative;
            z-index: 2;
            color: #2d3748;
            font-weight: 700;
        }

        .role-tab span {
            position: relative;
            z-index: 1;
        }

        .role-tab:hover:not(.active) {
            color: #4a5568;
            background: rgba(255, 255, 255, 0.5);
        }

        .role-tab-text {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-description {
            font-size: 12px;
            color: #718096;
            margin-top: 4px;
            padding: 0 4px;
            text-align: center;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .register-btn {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .register-btn:active {
            transform: translateY(0);
        }

        .footer {
            text-align: center;
            margin-top: 20px;
        }

        .login-link {
            font-size: 14px;
            color: #718096;
        }

        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .login-link a:hover {
            color: #764ba2;
        }

        .error {
            color: #e53e3e;
            font-size: 13px;
            margin-top: 8px;
            padding: 10px 12px;
            background: #fff5f5;
            border-left: 3px solid #e53e3e;
            border-radius: 4px;
            display: none;
        }

        .error.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success {
            display: none;
            color: #22543d;
            font-size: 14px;
            padding: 12px 16px;
            background: #f0fff4;
            border-left: 3px solid #22543d;
            border-radius: 4px;
            margin-top: 16px;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }

        .success.show {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tick {
            font-size: 18px;
        }

        .loading {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .register-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .otp-btn {
            padding: 12px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .otp-btn:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .otp-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .otp-verified {
            color: #22543d;
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .register-container {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .register-info {
                padding: 20px 0;
            }

            .register-info h2 {
                font-size: 36px;
            }
        }

        @media (max-width: 768px) {
            .register-card {
                padding: 40px 30px;
            }

            .register-info h2 {
                font-size: 28px;
            }

            .register-info p {
                font-size: 16px;
            }

            h1 {
                font-size: 24px;
            }

            .subtitle {
                font-size: 13px;
            }

            .form-group {
                margin-bottom: 18px;
            }
        }
    </style>
</head>
<body>

    <div class="register-container">
        <!-- Left Side - Information Section -->
        <div class="register-info">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
                <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4); font-size: 64px;">
                    üì¶
                </div>
                <div>
                    <h2 style="margin: 0; font-size: 42px; font-weight: 700; line-height: 1.2; color: #000000;">JOIN SMARTSTOCK INVENTORY</h2>
                </div>
            </div>
            <p>Create your account to start managing inventory efficiently. Get access to powerful tools for stock tracking, sales management, and business analytics.</p>
            
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon">üì¶</div>
                    <div class="feature-content">
                        <h3>Real-time Inventory Tracking</h3>
                        <p>Monitor stock levels, track product movements, and get instant alerts for low inventory items.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">üí∞</div>
                    <div class="feature-content">
                        <h3>Sales Management</h3>
                        <p>Process sales transactions, manage customer orders, and track revenue with detailed reporting.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">üìä</div>
                    <div class="feature-content">
                        <h3>Business Analytics</h3>
                        <p>Get insights into sales trends, popular products, and business performance with interactive dashboards.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">üîî</div>
                    <div class="feature-content">
                        <h3>Smart Alerts</h3>
                        <p>Automated notifications for low stock, expiring products, and important business deadlines.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">üì±</div>
                    <div class="feature-content">
                        <h3>Mobile Access</h3>
                        <p>Manage your inventory on-the-go with our mobile-responsive interface and real-time sync.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">üîê</div>
                    <div class="feature-content">
                        <h3>Secure User Management</h3>
                        <p>Role-based access control, secure authentication, and protected business data.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side - Register Card -->
        <div>
            <div class="register-card">
                <!-- Header Section -->
                <div class="header">
                    <div class="logo">üì¶</div>
                    <h1>Create Account</h1>
                    <p class="subtitle">Fill in your details to get started</p>
                </div>

                <!-- Registration Form -->
                <div class="register-content">
                    <!-- Role Selection -->
                    <div class="form-group">
                        <label>Choose Your Role</label>
                        <div class="role-tabs">
                            <button class="role-tab active" onclick="selectRole('admin')" data-role="admin">
                            <div class="role-tab-text">Owner</div>
                        </button>
                            <button type="button" class="role-tab" data-role="user" onclick="selectRole('user')">
                                <span>
                                    <div class="role-tab-text">Employee</div>
                                </span>
                            </button>
                        </div>
                        <div class="role-description" id="roleDescription">
                            Select your role to continue
                        </div>
                        <input type="hidden" id="role" required>
                    </div>

                    <!-- Registration Form Fields -->
                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <!-- Username Field -->
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input 
                                type="text" 
                                id="username" 
                                placeholder="Enter your username"
                                required
                                autocomplete="username"
                            >
                        </div>

                        <!-- First Name Field -->
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <input 
                                type="text" 
                                id="firstName" 
                                placeholder="Enter your first name"
                                required
                                autocomplete="given-name"
                            >
                        </div>

                        <!-- Last Name Field -->
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input 
                                type="text" 
                                id="lastName" 
                                placeholder="Enter your last name"
                                required
                                autocomplete="family-name"
                            >
                        </div>

                        <!-- Email Field -->
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input 
                                type="email" 
                                id="email" 
                                placeholder="Enter your email address"
                                required
                                autocomplete="email"
                            >
                        </div>

                        <!-- Password Field -->
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input 
                                type="password" 
                                id="password" 
                                placeholder="Create a strong password"
                                required
                                autocomplete="new-password"
                                oninput="checkPasswordStrength()"
                            >
                            <div id="passwordStrength" style="margin-top: 8px; font-size: 12px; font-weight: 500;"></div>
                        </div>

                        <!-- Confirm Password Field -->
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input 
                                type="password" 
                                id="confirmPassword" 
                                placeholder="Confirm your password"
                                required
                                autocomplete="new-password"
                            >
                        </div>

                        <!-- Contact Number Field -->
                        <div class="form-group">
                            <label for="contactNumber">Contact Number</label>
                            <input 
                                type="text" 
                                id="contactNumber" 
                                placeholder="Enter your mobile number"
                                required
                                autocomplete="tel"
                            >
                        </div>

                        <!-- Shop Address Field -->
                        <div class="form-group">
                            <label for="shopAddress">Shop Address</label>
                            <input 
                                type="text" 
                                id="shopAddress" 
                                placeholder="Enter your shop address"
                                required
                                autocomplete="street-address"
                            >
                        </div>

                        <!-- GSTIN Number Field (Optional) -->
                        <div class="form-group">
                            <label for="gstin">GSTIN Number (Optional)</label>
                            <input 
                                type="text" 
                                id="gstin" 
                                placeholder="Enter your GSTIN number (e.g., 27AAAPL0745C1ZV)"
                                maxlength="15"
                                style="text-transform: uppercase;"
                                autocomplete="off"
                            >
                        </div>

                        <!-- City Field -->
                        <div class="form-group">
                            <label for="city">City/Town</label>
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="city" 
                                    placeholder="Enter your city"
                                    required
                                    autocomplete="off"
                                    style="width: 100%;"
                                >
                                <div id="citySuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-top: none; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
                            </div>
                        </div>

                        <!-- State Field -->
                        <div class="form-group">
                            <label for="state">State</label>
                            <select 
                                id="state" 
                                required
                                autocomplete="address-level1"
                            >
                                <option value="">Select your state</option>
                            </select>
                        </div>

                        <!-- Pincode Field -->
                        <div class="form-group">
                            <label for="pincode">Pincode</label>
                            <input 
                                type="text" 
                                id="pincode" 
                                placeholder="Enter 6-digit pincode"
                                maxlength="6"
                                list="pincodes"
                                required
                                autocomplete="postal-code"
                            >
                            <datalist id="pincodes">
                                <option value="110001">Delhi - 110001</option>
                                <option value="400001">Hyderabad - 500001</option>
                                <option value="560001">Bangalore - 560001</option>
                                <option value="600001">Chennai - 600001</option>
                                <option value="700001">Kolkata - 700001</option>
                                <option value="411001">Mumbai - 400001</option>
                                <option value="380001">Ahmedabad - 380001</option>
                                <option value="500001">Pune - 411011</option>
                                <option value="302001">Jaipur - 302001</option>
                                <option value="500018">Surat - 395001</option>
                                <option value="500009">Lucknow - 226001</option>
                                <option value="500017">Kanpur - 208001</option>
                                <option value="500025">Nagpur - 440001</option>
                                <option value="500033">Indore - 452001</option>
                                <option value="500070">Bhopal - 462001</option>
                                <option value="560078">Jaipur - 302015</option>
                                <option value="500022">Kolkata - 700001</option>
                                <option value="560034">Chennai - 600001</option>
                                <option value="500038">Bangalore - 560001</option>
                                <option value="500043">Hyderabad - 500001</option>
                                <option value="500024">Visakhapatnam - 530001</option>
                                <option value="500032">Vijayawada - 520001</option>
                                <option value="500025">Nagpur - 440001</option>
                                <option value="500026">Indore - 452001</option>
                                <option value="500023">Bhopal - 462001</option>
                                <option value="500025">Nagpur - 440001</option>
                                <option value="500034">Coimbatore - 641001</option>
                                <option value="500036">Madurai - 625001</option>
                                <option value="500014">Salem - 636001</option>
                                <option value="500021">Tiruchirappalli - 620001</option>
                                <option value="500028">Warangal - 506001</option>
                                <option value="500037">Erode - 638001</option>
                                <option value="500018">Thiruvananthapuram - 620001</option>
                                <option value="500017">Kozhikode - 678001</option>
                                <option value="500025">Tiruppur - 627001</option>
                                <option value="500034">Thanjavur - 621001</option>
                                <option value="500027">Dindigul - 582001</option>
                                <option value="500025">Nagpur - 440001</option>
                                <option value="500022">Gwalior - 474001</option>
                                <option value="500033">Jabalpur - 482001</option>
                                <option value="500030">Agra - 282001</option>
                                <option value="500025">Mathura - 281001</option>
                                <option value="500024">Aligarh - 202001</option>
                                <option value="500025">Firozabad - 283001</option>
                                <option value="500034">Allahabad - 211001</option>
                                <option value="500025">Bareilly - 263001</option>
                                <option value="500025">Gorakhpur - 273001</option>
                                <option value="500025">Kanpur - 208001</option>
                                <option value="500032">Bhilai - 460001</option>
                                <option value="500025">Bhopal - 462001</option>
                                <option value="500025">Nagpur - 440001</option>
                                <option value="500032">Indore - 452001</option>
                                <option value="500025">Satna - 485001</option>
                                <option value="500025">Rewa - 486001</option>
                                <option value="500025">Jhansi - 282001</option>
                                <option value="500025">Ujjain - 456001</option>
                                <option value="500025">Sagar - 470001</option>
                                <option value="500025">Damoh - 452001</option>
                                <option value="500025">Chhindwara - 473001</option>
                                <option value="500025">Ratlam - 465001</option>
                                <option value="500025">More major Indian locations available</option>
                            </datalist>
                        </div>

                        <!-- OTP Verification Section -->
                        <div class="form-group" id="otpSection" style="display: none;">
                            <label for="otp">Verification Code</label>
                            <div style="display: flex; gap: 8px;">
                                <input 
                                    type="text" 
                                    id="otp" 
                                    placeholder="Enter 6-digit code"
                                    maxlength="6"
                                    style="flex: 1;"
                                >
                                <button 
                                    type="button" 
                                    class="otp-btn" 
                                    id="sendOtpBtn"
                                    onclick="sendOTP()"
                                >
                                    Send OTP
                                </button>
                            </div>
                            <div class="otp-timer" id="otpTimer" style="display: none; font-size: 12px; color: #718096; margin-top: 4px;">
                                Resend OTP in <span id="timerCount">30</span> seconds
                            </div>
                        </div>

                        <!-- Error Message -->
                        <div class="error" id="errorMsg"></div>

                        <!-- Success Message -->
                        <div class="success" id="successBox">
                            <div class="tick">‚úì</div>
                            <div>Registration successful! Redirecting to login...</div>
                        </div>

                        <!-- Terms and Conditions Checkbox -->
                        <div class="form-group">
                            <label for="termsCheckbox" class="checkbox-label">
                                <input 
                                    type="checkbox" 
                                    id="termsCheckbox" 
                                    onchange="toggleRegisterButton()"
                                >
                                <span class="checkmark"></span>
                                I confirm that all the information provided is correct and I agree to the Terms of Service and Privacy Policy
                            </label>
                        </div>

                        <!-- Register Button -->
                        <div class="form-group">
                            <button type="submit" class="register-btn" id="registerBtn" disabled>
                                <span class="tick">‚úì</span>
                                <span id="btn-text">Create Account</span>
                                <div class="loading" id="btn-loading"></div>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Footer Section -->
                <div class="footer">
                    <div class="login-link">
                        Already have an account? <a href="login.html">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
        // Check password strength - defined immediately for global access
        window.checkPasswordStrength = function() {
            console.log("checkPasswordStrength called"); // Debug log
            const password = document.getElementById("password").value;
            const strengthIndicator = document.getElementById("passwordStrength");
            
            console.log("Password:", password); // Debug log
            
            if (!password) {
                strengthIndicator.textContent = '';
                strengthIndicator.style.color = '#666';
                return;
            }
            
            // Calculate password strength
            let strength = 0;
            let strengthText = '';
            let strengthColor = '#e53e3e'; // red for weak
            
            // Check length
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            
            // Check for lowercase
            if (/[a-z]/.test(password)) strength += 1;
            
            // Check for uppercase
            if (/[A-Z]/.test(password)) strength += 1;
            
            // Check for numbers
            if (/\d/.test(password)) strength += 1;
            
            // Check for special characters
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
            
            console.log("Password strength score:", strength); // Debug log
            
            // Determine strength level with automatic feedback
            if (strength <= 2) {
                strengthText = 'Weak Password';
                strengthColor = '#e53e3e'; // red
            } else if (strength <= 3) {
                strengthText = 'Medium Password';
                strengthColor = '#ed8936'; // orange
            } else if (strength <= 4) {
                strengthText = 'Strong Password';
                strengthColor = '#38a169'; // yellow
            } else {
                strengthText = 'Very Strong Password';
                strengthColor = '#28a745'; // green
            }
            
            console.log("Strength text:", strengthText, "Color:", strengthColor); // Debug log
            
            // Update strength indicator automatically
            strengthIndicator.textContent = strengthText;
            strengthIndicator.style.color = strengthColor;
            
            // Show automatic feedback message
            if (strength <= 2) {
                showError('Password is weak. Add uppercase, numbers, and special characters.');
            } else if (strength >= 4) {
                clearMessages(); // Clear error when password becomes strong
            }
        };

        // Toggle register button based on terms checkbox - defined immediately for global access
        window.toggleRegisterButton = function() {
            console.log("toggleRegisterButton called"); // Debug log
            const checkbox = document.getElementById('termsCheckbox');
            const registerBtn = document.getElementById('registerBtn');
            const btnText = document.getElementById('btn-text');
            
            console.log("Checkbox checked:", checkbox.checked); // Debug log
            console.log("Button disabled before:", registerBtn.disabled); // Debug log
            
            if (checkbox.checked) {
                registerBtn.disabled = false;
                btnText.textContent = 'Create Account';
                registerBtn.style.opacity = '1';
                registerBtn.style.cursor = 'pointer';
                console.log("Button enabled"); // Debug log
            } else {
                registerBtn.disabled = true;
                btnText.textContent = 'Please accept terms to continue';
                registerBtn.style.opacity = '0.7';
                registerBtn.style.cursor = 'not-allowed';
                console.log("Button disabled"); // Debug log
            }
        };

        // Show error message - defined immediately for global access
        window.showError = function(message) {
            const errorBox = document.getElementById("errorMsg");
            errorBox.textContent = message;
            errorBox.classList.add("show");
        };

        // Clear all messages - defined immediately for global access
        window.clearMessages = function() {
            const errorBox = document.getElementById("errorMsg");
            errorBox.classList.remove("show");
        };

        // Check password strength
        function checkPasswordStrength() {
            console.log("Password strength check triggered"); // Debug log
            const password = document.getElementById("password").value;
            const strengthIndicator = document.getElementById("passwordStrength");
            
            console.log("Current password:", password); // Debug log
            
            if (!password) {
                strengthIndicator.textContent = '';
                strengthIndicator.style.color = '#666';
                return;
            }
            
            // Calculate password strength
            let strength = 0;
            let strengthText = '';
            let strengthColor = '#e53e3e'; // red for weak
            
            // Check length
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            
            // Check for lowercase
            if (/[a-z]/.test(password)) strength += 1;
            
            // Check for uppercase
            if (/[A-Z]/.test(password)) strength += 1;
            
            // Check for numbers
            if (/\d/.test(password)) strength += 1;
            
            // Check for special characters
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
            
            console.log("Password strength score:", strength); // Debug log
            
            // Determine strength level with automatic feedback
            if (strength <= 2) {
                strengthText = 'Weak Password';
                strengthColor = '#e53e3e'; // red
            } else if (strength <= 3) {
                strengthText = 'Medium Password';
                strengthColor = '#ed8936'; // orange
            } else if (strength <= 4) {
                strengthText = 'Strong Password';
                strengthColor = '#38a169'; // yellow
            } else {
                strengthText = 'Very Strong Password';
                strengthColor = '#28a745'; // green
            }
            
            console.log("Strength text:", strengthText, "Color:", strengthColor); // Debug log
            
            // Update strength indicator automatically
            strengthIndicator.textContent = strengthText;
            strengthIndicator.style.color = strengthColor;
            
            // Show automatic feedback message
            if (strength <= 2) {
                showError('Password is weak. Add uppercase, numbers, and special characters.');
            } else if (strength >= 4) {
                clearMessages(); // Clear error when password becomes strong
            }
        }

    // Toggle register button based on terms checkbox
    function toggleRegisterButton() {
        console.log("toggleRegisterButton called"); // Debug log
        const checkbox = document.getElementById('termsCheckbox');
        const registerBtn = document.getElementById('registerBtn');
        const btnText = document.getElementById('btn-text');
        
        console.log("Checkbox checked:", checkbox.checked); // Debug log
        console.log("Button disabled before:", registerBtn.disabled); // Debug log
        
        if (checkbox.checked) {
            registerBtn.disabled = false;
            btnText.textContent = 'Create Account';
            registerBtn.style.opacity = '1';
            registerBtn.style.cursor = 'pointer';
            console.log("Button enabled"); // Debug log
        } else {
            registerBtn.disabled = true;
            btnText.textContent = 'Please accept terms to continue';
            registerBtn.style.opacity = '0.7';
            registerBtn.style.cursor = 'not-allowed';
            console.log("Button disabled"); // Debug log
        }
    }

    // Show error message
    function showError(message) {
        const errorBox = document.getElementById("errorMsg");
        errorBox.textContent = message;
        errorBox.classList.add("show");
    }

    // Clear all messages
    function clearMessages() {
        const errorBox = document.getElementById("errorMsg");
        errorBox.classList.remove("show");
    }

    // Indian Cities Data (Major Cities)
    const indianCities = [
        "Mumbai", "Delhi", "Bangalore", "Hyderabad", "Ahmedabad", "Chennai", "Kolkata",
        "Surat", "Pune", "Jaipur", "Lucknow", "Kanpur", "Nagpur", "Indore",
        "Thane", "Bhopal", "Visakhapatnam", "Pimpri-Chinchwad", "Patna", "Vadodara",
        "Ghaziabad", "Ludhiana", "Agra", "Nashik", "Faridabad", "Meerut",
        "Rajkot", "Kalyan-Dombivali", "Vasai-Virar", "Varanasi", "Srinagar",
        "Dhanbad", "Jodhpur", "Amritsar", "Raipur", "Allahabad",
        "Coimbatore", "Jabalpur", "Gwalior", "Vijayawada", "Madurai",
        "Guwahati", "Chandigarh", "Hubli-Dharwad", "Mysore", "Tiruchirappalli",
        "Bareilly", "Aligarh", "Tiruppur", "Moradabad", "Jalandhar",
        "Bhubaneswar", "Salem", "Warangal", "Mangalore", "Noida",
        "Kochi", "Thrissur", "Navi Mumbai", "Kota", "Vijayanagaram",
        "Tirupati", "Rourkela", "Agartala", "Dehradun", "Asansol",
        "Nanded", "Kolhapur", "Ajmer", "Akola", "Gulbarga", "Jamnagar",
        "Ujjain", "Loni", "Siliguri", "Jhansi", "Uluberia", "Nellore",
        "Jammu", "Sangli-Miraj", "Kurnool", "Rajahmundry", "Tirunelveli",
        "Malegaon", "Gaya", "Jalgaon", "Udaipur", "Maheshtala"
    ];

    // Indian States Data
    const indianStates = [
        "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa",
        "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala",
        "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland",
        "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana",
        "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal", "Andaman and Nicobar Islands",
        "Chandigarh", "Dadra and Nagar Haveli", "Daman and Diu", "Delhi", "Jammu and Kashmir",
        "Ladakh", "Lakshadweep", "Puducherry"
    ];

    // Populate states dropdown
    function populateStates() {
        const stateSelect = document.getElementById('state');
        indianStates.forEach(state => {
            const option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            stateSelect.appendChild(option);
        });
    }

    // City autocomplete functionality
    function setupCityAutocomplete() {
        const cityInput = document.getElementById('city');
        const suggestionsDiv = document.getElementById('citySuggestions');

        cityInput.addEventListener('input', function() {
            const value = this.value.toLowerCase().trim();
            
            if (value.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            const filteredCities = indianCities.filter(city => 
                city.toLowerCase().includes(value)
            );

            if (filteredCities.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            suggestionsDiv.innerHTML = '';
            filteredCities.slice(0, 10).forEach(city => {
                const div = document.createElement('div');
                div.style.padding = '10px 15px';
                div.style.cursor = 'pointer';
                div.style.borderBottom = '1px solid #f0f0f0';
                div.style.fontSize = '14px';
                div.textContent = city;
                
                div.addEventListener('click', function() {
                    cityInput.value = city;
                    suggestionsDiv.style.display = 'none';
                });

                div.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f7fafc';
                });

                div.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'white';
                });

                suggestionsDiv.appendChild(div);
            });

            suggestionsDiv.style.display = filteredCities.length > 0 ? 'block' : 'none';
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!cityInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });
    }
    setupCityAutocomplete();

    // OTP verification variables
    let generatedOTP = '';
    let otpTimer = null;
    let isOTPVerified = false;

    // Role selection functionality
    function selectRole(role) {
        // Remove active class from all tabs
        document.querySelectorAll('.role-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Add active class to selected tab
        document.querySelector(`[data-role="${role}"]`).classList.add('active');
        
        // Set hidden input value
        document.getElementById('role').value = role;
        
        // Update description and button text
        const description = document.getElementById('roleDescription');
        const btnText = document.getElementById('btn-text');
        
        if (role === 'admin') {
            description.textContent = 'Full access to all system features and settings';
            btnText.textContent = 'Register as Owner';
        } else if (role === 'user') {
            description.textContent = 'Access to inventory management and sales features';
            btnText.textContent = 'Register as Employee';
        }
        
        // Clear any error messages
        clearMessages();
    }

    // Show OTP section when contact number is entered
    document.getElementById('contactNumber')?.addEventListener('input', function(e) {
        const contactNumber = e.target.value.trim();
        const otpSection = document.getElementById('otpSection');
        
        if (contactNumber.length >= 10) {
            otpSection.style.display = 'block';
        } else {
            otpSection.style.display = 'none';
            isOTPVerified = false;
        }
    });

    // Send OTP function
    function sendOTP() {
        const contactNumber = document.getElementById('contactNumber').value.trim();
        
        if (contactNumber.length < 10) {
            showError('Please enter a valid contact number');
            return;
        }

        // Generate demo OTP (6-digit number)
        generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
        
        // Show demo OTP in console (for testing)
        console.log('Demo OTP for testing:', generatedOTP);
        
        // Show success message
        showInfo(`OTP sent to ${contactNumber}. Demo OTP: ${generatedOTP}`);
        
        // Start timer
        startOTPTimer();
        
        // Disable send button
        const sendBtn = document.getElementById('sendOtpBtn');
        sendBtn.disabled = true;
        sendBtn.textContent = 'OTP Sent';
    }

    // Start OTP timer
    function startOTPTimer() {
        let timeLeft = 30;
        const timerElement = document.getElementById('otpTimer');
        const timerCount = document.getElementById('timerCount');
        
        timerElement.style.display = 'block';
        
        otpTimer = setInterval(() => {
            timeLeft--;
            timerCount.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(otpTimer);
                timerElement.style.display = 'none';
                
                // Re-enable send button
                const sendBtn = document.getElementById('sendOtpBtn');
                sendBtn.disabled = false;
                sendBtn.textContent = 'Resend OTP';
            }
        }, 1000);
    }

    // Verify OTP
    document.getElementById('otp')?.addEventListener('input', function(e) {
        const enteredOTP = e.target.value;
        
        if (enteredOTP.length === 6) {
            if (enteredOTP === generatedOTP) {
                isOTPVerified = true;
                showInfo('OTP verified successfully!');
                
                // Clear timer
                if (otpTimer) {
                    clearInterval(otpTimer);
                }
                
                // Disable OTP input and show verified status
                e.target.disabled = true;
                document.getElementById('sendOtpBtn').disabled = true;
                document.getElementById('sendOtpBtn').textContent = 'Verified';
            } else {
                showError('Invalid OTP. Please try again.');
                e.target.value = '';
            }
        }
    });

    // Show info message
    function showInfo(message) {
        const errorBox = document.getElementById('errorMsg');
        errorBox.textContent = message;
        errorBox.style.background = '#e6fffa';
        errorBox.style.borderLeftColor = '#38b2ac';
        errorBox.style.color = '#234e52';
        errorBox.classList.add('show');
        
        setTimeout(() => {
            errorBox.classList.remove('show');
        }, 3000);
    }

    // Handle form submission
    async function handleRegister(event) {
        event.preventDefault();

        const username = document.getElementById("username").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;
        const contactNumber = document.getElementById("contactNumber").value.trim();
        const shopAddress = document.getElementById("shopAddress").value.trim();
        const gstin = document.getElementById("gstin").value.trim().toUpperCase();
        const city = document.getElementById("city").value.trim();
        const state = document.getElementById("state").value;
        const pincode = document.getElementById("pincode").value.trim();
        const role = document.getElementById("role").value;

        // Validate inputs (excluding GSTIN as it's optional)
        if (!username || !email || !password || !confirmPassword || !contactNumber || !shopAddress || !city || !state || !pincode || !role) {
            showError("Please fill in all required fields");
            return;
        }

        // Validate contact number
        if (contactNumber.length < 10) {
            showError("Please enter a valid contact number");
            return;
        }

        // Validate shop address
        if (shopAddress.length < 10) {
            showError("Please enter a complete shop address");
            return;
        }

        // Validate city
        if (city.length < 2) {
            showError("Please enter a valid city name");
            return;
        }

        // Validate state
        if (!state) {
            showError("Please select your state");
            return;
        }

        // Validate pincode
        if (pincode.length !== 6) {
            showError("Please enter a valid 6-digit pincode");
            return;
        }

        // Validate GSTIN (optional - only if provided)
        if (gstin && gstin.length > 0) {
            // Basic GSTIN format validation (15 characters, starts with state code)
            if (gstin.length !== 15) {
                showError("GSTIN must be 15 characters long");
                return;
            }
            // Check if it follows basic GSTIN pattern (alphanumeric)
            if (!/^[A-Z0-9]+$/.test(gstin)) {
                showError("GSTIN must contain only letters and numbers");
                return;
            }
        }

        // Validate OTP verification
        if (!isOTPVerified) {
            showError("Please verify your contact number with OTP");
            return;
        }

        // Validate password match
        if (password !== confirmPassword) {
            showError("Passwords do not match");
            return;
        }

        // Check password strength
        function checkPasswordStrength() {
            console.log("Password strength check triggered"); // Debug log
            const password = document.getElementById("password").value;
            const strengthIndicator = document.getElementById("passwordStrength");
            
            console.log("Current password:", password); // Debug log
            
            if (!password) {
                strengthIndicator.textContent = '';
                strengthIndicator.style.color = '#666';
                return;
            }
            
            // Calculate password strength
            let strength = 0;
            let strengthText = '';
            let strengthColor = '#e53e3e'; // red for weak
            
            // Check length
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            
            // Check for lowercase
            if (/[a-z]/.test(password)) strength += 1;
            
            // Check for uppercase
            if (/[A-Z]/.test(password)) strength += 1;
            
            // Check for numbers
            if (/\d/.test(password)) strength += 1;
            
            // Check for special characters
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
            
            console.log("Password strength score:", strength); // Debug log
            
            // Determine strength level with automatic feedback
            if (strength <= 2) {
                strengthText = 'Weak Password';
                strengthColor = '#e53e3e'; // red
            } else if (strength <= 3) {
                strengthText = 'Medium Password';
                strengthColor = '#ed8936'; // orange
            } else if (strength <= 4) {
                strengthText = 'Strong Password';
                strengthColor = '#38a169'; // yellow
            } else {
                strengthText = 'Very Strong Password';
                strengthColor = '#28a745'; // green
            }
            
            console.log("Strength text:", strengthText, "Color:", strengthColor); // Debug log
            
            // Update strength indicator automatically
            strengthIndicator.textContent = strengthText;
            strengthIndicator.style.color = strengthColor;
            
            // Show automatic feedback message
            if (strength <= 2) {
                showError('Password is weak. Add uppercase, numbers, and special characters.');
            } else if (strength >= 4) {
                clearMessages(); // Clear error when password becomes strong
            }
        }

        // Validate password strength
        if (password.length < 6) {
            showError("Password must be at least 6 characters long");
            return;
        }

        // Clear previous messages
        clearMessages();
        
        // Disable button and show loading
        const registerBtn = document.getElementById("registerBtn");
        const btnText = document.getElementById("btn-text");
        const btnLoading = document.getElementById("btn-loading");
        
        registerBtn.disabled = true;
        btnText.style.display = "none";
        btnLoading.style.display = "block";

        try {
            const response = await fetch("http://127.0.0.1:5000/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username: username,
                    email: email,
                    password: password,
                    role: role,
                    contactNumber: contactNumber,
                    shopAddress: shopAddress,
                    gstin: gstin,
                    city: city,
                    state: state,
                    pincode: pincode
                })
            });

            const data = await response.json();

            if (response.ok) {
                // Show success message
                document.getElementById("successBox").classList.add("show");

                // Redirect after brief delay
                setTimeout(() => {
                    window.location.href = "login.html";
                }, 2000);
            } else {
                // Handle specific error messages
                let errorMessage = data.message || "Registration failed. Please try again.";
                
                // Make error messages more user-friendly
                if (data.message === "Username already exists") {
                    errorMessage = "This username is already taken. Please choose a different username.";
                } else if (data.message === "Email already exists") {
                    errorMessage = "This email is already registered. Please use a different email or try logging in.";
                }
                
                showError(errorMessage);
                resetButton(registerBtn, btnText, btnLoading);
            }
        } catch (error) {
            showError("Network error. Please check your connection and try again.");
            resetButton(registerBtn, btnText, btnLoading);
            console.error("Registration error:", error);
        }
    }

    // Show error message
    function showError(message) {
        const errorBox = document.getElementById("errorMsg");
        errorBox.textContent = message;
        errorBox.classList.add("show");
    }

    // Clear all messages
    function clearMessages() {
        const errorBox = document.getElementById("errorMsg");

            // Validate GSTIN (optional - only if provided)
            if (gstin && gstin.length > 0) {
                // Basic GSTIN format validation (15 characters, starts with state code)
                if (gstin.length !== 15) {
                    showError("GSTIN must be 15 characters long");
                    return;
                }
                // Check if it follows basic GSTIN pattern (alphanumeric)
                if (!/^[A-Z0-9]+$/.test(gstin)) {
                    showError("GSTIN must contain only letters and numbers");
                    return;
                }
            }

            // Validate OTP verification
            if (!isOTPVerified) {
                showError("Please verify your contact number with OTP");
                return;
            }

            // Validate password match
            if (password !== confirmPassword) {
                showError("Passwords do not match");
                return;
            }

            // Check password strength
            function checkPasswordStrength() {
                console.log("Password strength check triggered"); // Debug log
                const password = document.getElementById("password").value;
                const strengthIndicator = document.getElementById("passwordStrength");
                
                console.log("Current password:", password); // Debug log
                
                if (!password) {
                    strengthIndicator.textContent = '';
                    strengthIndicator.style.color = '#666';
                    return;
                }
                
                // Calculate password strength
                let strength = 0;
                let strengthText = '';
                let strengthColor = '#e53e3e'; // red for weak
                
                // Check length
                if (password.length >= 8) strength += 1;
                if (password.length >= 12) strength += 1;
                
                // Check for lowercase
                if (/[a-z]/.test(password)) strength += 1;
                
                // Check for uppercase
                if (/[A-Z]/.test(password)) strength += 1;
                
                // Check for numbers
                if (/\d/.test(password)) strength += 1;
                
                // Check for special characters
                if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
                
                console.log("Password strength score:", strength); // Debug log
                
                // Determine strength level with automatic feedback
                if (strength <= 2) {
                    strengthText = 'Weak Password';
                    strengthColor = '#e53e3e'; // red
                } else if (strength <= 3) {
                    strengthText = 'Medium Password';
                    strengthColor = '#ed8936'; // orange
                } else if (strength <= 4) {
                    strengthText = 'Strong Password';
                    strengthColor = '#38a169'; // yellow
                } else {
                    strengthText = 'Very Strong Password';
                    strengthColor = '#28a745'; // green
                }
                
                console.log("Strength text:", strengthText, "Color:", strengthColor); // Debug log
                
                // Update strength indicator automatically
                strengthIndicator.textContent = strengthText;
                strengthIndicator.style.color = strengthColor;
                
                // Show automatic feedback message
                if (strength <= 2) {
                    showError('Password is weak. Add uppercase, numbers, and special characters.');
                } else if (strength >= 4) {
                    clearMessages(); // Clear error when password becomes strong
                }
            }

            }

    // Reset button to original state
    function resetButton(registerBtn, btnText, btnLoading) {
        registerBtn.disabled = false;
        btnText.style.display = "block";
        btnLoading.style.display = "none";
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        populateStates();
        setupCityAutocomplete();
    });

</script>

</body>
</html>
